name: Adaptive Node Collocation

on:
  workflow_dispatch:
    inputs:
      latitude:
        description: "Latitude in decimal degrees (e.g. 29.7604)"
        required: true
        type: string
      longitude:
        description: "Longitude in decimal degrees (e.g. -95.3698)"
        required: true
        type: string
      elevation:
        description: "Elevation value at origin (e.g. 15.0)"
        required: true
        type: string
      elevation_unit:
        description: "Unit of elevation origin (m or ft)"
        required: true
        default: "m"
        type: choice
        options:
          - m
          - ft
      lat_unit_size:
        description: "Latitudinal unit size in degrees for node cell"
        required: false
        default: "0.01"
        type: string
      lon_unit_size:
        description: "Longitudinal unit size in degrees for node cell"
        required: false
        default: "0.01"
        type: string
      elev_unit_size:
        description: "Elevation unit size in elevation_unit for node cell"
        required: false
        default: "10.0"
        type: string

jobs:
  collocate-adaptive-node:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies (if any)
        run: |
          python -m pip install --upgrade pip
          # Add your dependencies here if you extend the script
          # pip install -r requirements.txt

      - name: Run adaptive-node collocation
        env:
          INPUT_LATITUDE: ${{ github.event.inputs.latitude }}
          INPUT_LONGITUDE: ${{ github.event.inputs.longitude }}
          INPUT_ELEVATION: ${{ github.event.inputs.elevation }}
          INPUT_ELEVATION_UNIT: ${{ github.event.inputs.elevation_unit }}
          INPUT_LAT_UNIT_SIZE: ${{ github.event.inputs.lat_unit_size }}
          INPUT_LON_UNIT_SIZE: ${{ github.event.inputs.lon_unit_size }}
          INPUT_ELEV_UNIT_SIZE: ${{ github.event.inputs.elev_unit_size }}
        run: |
          python tools/collocate_adaptive_node.py \
            --lat "$INPUT_LATITUDE" \
            --lon "$INPUT_LONGITUDE" \
            --elev "$INPUT_ELEVATION" \
            --elev-unit "$INPUT_ELEVATION_UNIT" \
            --lat-unit-size "$INPUT_LAT_UNIT_SIZE" \
            --lon-unit-size "$INPUT_LON_UNIT_SIZE" \
            --elev-unit-size "$INPUT_ELEV_UNIT_SIZE"
